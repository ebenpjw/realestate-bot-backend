(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{73928:function(e,t,a){Promise.resolve().then(a.bind(a,24042)),Promise.resolve().then(a.bind(a,86868)),Promise.resolve().then(a.t.bind(a,17129,23)),Promise.resolve().then(a.t.bind(a,6840,23)),Promise.resolve().then(a.t.bind(a,47960,23)),Promise.resolve().then(a.bind(a,14438))},24042:function(e,t,a){"use strict";a.d(t,{Providers:function(){return _}});var n=a(57437),o=a(2265),s=a(85315),i=a(83080),r=a(73965);class c{async getIntegrationStatus(e){return(await r.x.get("/dashboard/integrations/status",{params:{agentId:e}})).data.data}async getWABAIntegration(e){return(await r.x.get("/dashboard/integrations/waba",{params:{agentId:e}})).data.data}async connectWABA(e){return(await r.x.post("/dashboard/integrations/waba/connect",e)).data.data}async updateWABA(e){return(await r.x.patch("/dashboard/integrations/waba",e)).data.data}async disconnectWABA(){await r.x.post("/dashboard/integrations/waba/disconnect")}async testWABAConnection(e){return(await r.x.post("/dashboard/integrations/waba/test",{agentId:e})).data.data}async getWABAQRCode(){return(await r.x.get("/dashboard/integrations/waba/qr-code")).data.data}async getGoogleIntegration(e){return(await r.x.get("/dashboard/integrations/google",{params:{agentId:e}})).data.data}async getGoogleAuthUrl(e){return(await r.x.get("/auth/google",{params:{agentId:e}})).data}async disconnectGoogle(){await r.x.post("/dashboard/integrations/google/disconnect")}async testGoogleConnection(e){return(await r.x.post("/dashboard/integrations/google/test",{agentId:e})).data.data}async getZoomIntegration(e){return(await r.x.get("/dashboard/integrations/zoom",{params:{agentId:e}})).data.data}async getZoomAuthUrl(e){return(await r.x.get("/auth/zoom",{params:{agentId:e}})).data}async disconnectZoom(){await r.x.post("/dashboard/integrations/zoom/disconnect")}async testZoomConnection(e){return(await r.x.post("/dashboard/integrations/zoom/test",{agentId:e})).data.data}async updateZoomSettings(e){return(await r.x.patch("/dashboard/integrations/zoom/settings",e)).data.data}async getMetaBusinessIntegration(e){return(await r.x.get("/dashboard/integrations/meta",{params:{agentId:e}})).data.data}async getMetaAuthUrl(){return(await r.x.get("/dashboard/integrations/meta/auth-url")).data}async disconnectMeta(){await r.x.post("/dashboard/integrations/meta/disconnect")}async syncAllIntegrations(e){return(await r.x.post("/dashboard/integrations/sync-all",{agentId:e})).data.data}async getHealthCheck(e){return(await r.x.get("/dashboard/integrations/health",{params:{agentId:e}})).data.data}}let l=new c;var d=a(14438);let u=(0,o.createContext)(void 0);function g(e){let{children:t}=e,[a,i]=(0,o.useState)(null),[r,c]=(0,o.useState)([]),[g,m]=(0,o.useState)(!0),[h,b]=(0,o.useState)(null),{user:p,isAuthenticated:w}=(0,s.a)();(0,o.useEffect)(()=>{w&&p?f():(i(null),c([]),m(!1))},[w,p]);let f=async()=>{try{m(!0),b(null);let e=await l.getWABAIntegration(null==p?void 0:p.id);i(e),"connected"===e.status&&e.templates&&c(e.templates.map(e=>({id:e.id,name:e.name,category:e.category,status:e.status,language:e.language,content:""})))}catch(e){console.error("Failed to load WABA config:",e),b(e.message||"Failed to load WABA configuration")}finally{m(!1)}},A=(0,o.useCallback)(async e=>{try{m(!0),b(null);let t=await l.connectWABA(e);i(t),d.A.success("WABA Connected",{description:"Successfully connected WhatsApp Business API for ".concat(e.phoneNumber)}),await C()}catch(t){let e=t.message||"Failed to connect WABA";throw b(e),d.A.error("WABA Connection Failed",{description:e}),t}finally{m(!1)}},[]),y=(0,o.useCallback)(async e=>{try{m(!0),b(null);let t=await l.updateWABA(e);i(t),d.A.success("WABA Updated",{description:"WhatsApp Business API configuration updated successfully"})}catch(t){let e=t.message||"Failed to update WABA";throw b(e),d.A.error("WABA Update Failed",{description:e}),t}finally{m(!1)}},[]),_=(0,o.useCallback)(async()=>{try{m(!0),b(null),await l.disconnectWABA(),i(null),c([]),d.A.success("WABA Disconnected",{description:"WhatsApp Business API has been disconnected"})}catch(t){let e=t.message||"Failed to disconnect WABA";throw b(e),d.A.error("WABA Disconnect Failed",{description:e}),t}finally{m(!1)}},[]),v=(0,o.useCallback)(async()=>{try{let e=await l.testWABAConnection(null==p?void 0:p.id);if(e.success)return d.A.success("WABA Connection Test",{description:e.message}),!0;return d.A.error("WABA Connection Test Failed",{description:e.message}),!1}catch(e){return d.A.error("WABA Connection Test Failed",{description:e.message||"Failed to test WABA connection"}),!1}},[null==p?void 0:p.id]),C=(0,o.useCallback)(async()=>{try{if(!a||"connected"!==a.status)return;let e=await l.getWABAIntegration(null==p?void 0:p.id);e.templates&&c(e.templates.map(e=>({id:e.id,name:e.name,category:e.category,status:e.status,language:e.language,content:""})))}catch(e){console.error("Failed to refresh templates:",e),d.A.error("Failed to refresh templates",{description:e.message})}},[a,null==p?void 0:p.id]),x=(0,o.useCallback)(e=>r.find(t=>t.id===e),[r]),k={wabaConfig:a,templates:r,loading:g,error:h,connectWABA:A,updateWABA:y,disconnectWABA:_,testConnection:v,refreshTemplates:C,getTemplate:x,refreshStatus:(0,o.useCallback)(async()=>{await f()},[]),isConnected:(null==a?void 0:a.status)==="connected",hasError:!!h||(null==a?void 0:a.status)==="error"};return(0,n.jsx)(u.Provider,{value:k,children:t})}let m=(0,o.createContext)(void 0);function h(e){let{children:t}=e,[a,i]=(0,o.useState)(null),[c,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0),[g,h]=(0,o.useState)(null),{user:b,isAuthenticated:p}=(0,s.a)();(0,o.useEffect)(()=>{p&&b?w():(i(null),l(null),u(!1))},[p,b]);let w=async()=>{try{u(!0),h(null);let e=(await r.x.get("/dashboard/agent/config/".concat(null==b?void 0:b.id))).data.data;if(i({id:e.id,fullName:e.full_name,email:e.email,organizationId:e.organization_id,wabaPhoneNumber:e.waba_phone_number,wabaDisplayName:e.waba_display_name,botName:e.bot_name||"Doro",googleConnected:!!e.google_email,zoomConnected:!!e.zoom_user_id,wabaConnected:!!e.waba_phone_number,workingHours:e.working_hours||{start:9,end:18,days:[1,2,3,4,5]},timezone:e.timezone||"Asia/Singapore",botPersonalityConfig:e.bot_personality_config||{},customResponses:e.custom_responses||{},totalLeads:e.total_leads||0,activeConversations:e.active_conversations||0,conversionRate:e.conversion_rate||0,averageResponseTime:e.average_response_time||0}),(null==b?void 0:b.role)==="admin"||e.organization_id)try{let t=(await r.x.get("/dashboard/organization/config/".concat(e.organization_id))).data.data;l({id:t.id,name:t.name,slug:t.slug,subscriptionTier:t.subscription_tier,settings:t.settings||{},maxAgents:t.max_agents||10,currentAgents:t.current_agents||1,features:t.features||[]})}catch(e){console.warn("Failed to load organization config:",e)}}catch(e){console.error("Failed to load agent config:",e),h(e.message||"Failed to load agent configuration")}finally{u(!1)}},f=(0,o.useCallback)(async e=>{try{u(!0),h(null);let t=(await r.x.patch("/dashboard/agent/config/".concat(null==b?void 0:b.id),e)).data.data;i(e=>e?{...e,...t}:null)}catch(e){throw h(e.message||"Failed to update agent configuration"),e}finally{u(!1)}},[null==b?void 0:b.id]),A=(0,o.useCallback)(async()=>{await w()},[]),y=(0,o.useCallback)(async e=>{await f({botPersonalityConfig:e})},[f]),_=(0,o.useCallback)(async e=>{await f({customResponses:e})},[f]),v=(0,o.useCallback)(async e=>{await f({workingHours:e})},[f]),C=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;if(!a)return!1;let{workingHours:t,timezone:n}=a,o=new Date(e.toLocaleString("en-US",{timeZone:n})),s=o.getDay(),i=o.getHours();return t.days.includes(s)&&i>=t.start&&i<t.end},[a]),x=(0,o.useCallback)(()=>{if(!a)return null;let{workingHours:e,timezone:t}=a,n=new Date;for(let a=0;a<7;a++){let o=new Date(n);o.setDate(n.getDate()+a);let s=new Date(o.toLocaleString("en-US",{timeZone:t})),i=s.getDay();if(e.days.includes(i)&&(s.setHours(e.start,0,0,0),0===a&&n.getHours()>=e.start&&s.setTime(n.getTime()+36e5),s.getHours()<e.end))return s}return null},[a]),k=(0,o.useCallback)(()=>{if(!a||!c)return!1;let e="basic"===c.subscriptionTier?50:"pro"===c.subscriptionTier?200:1e3;return a.activeConversations<e},[a,c]);return(0,n.jsx)(m.Provider,{value:{agentConfig:a,organizationConfig:c,loading:d,error:g,updateAgentConfig:f,refreshAgentConfig:A,updateBotPersonality:y,updateCustomResponses:_,updateWorkingHours:v,isWithinWorkingHours:C,getNextAvailableSlot:x,canCreateNewConversation:k},children:t})}var b=a(42388),p=a(29827),w=a(25922),f=a(20993),A=a(30166);let y=new b.S({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:(e,t)=>(null==t?void 0:t.status)!==401&&(null==t?void 0:t.status)!==403&&e<3,refetchOnWindowFocus:!1,refetchOnReconnect:"always"},mutations:{retry:1}}});function _(e){let{children:t}=e,[a,r]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{r(!0)},[]),(0,n.jsx)(p.aH,{client:y,children:(0,n.jsx)(w.f,{attribute:"class",defaultTheme:"light",enableSystem:!0,disableTransitionOnChange:!0,children:(0,n.jsx)(f.pn,{delayDuration:300,children:(0,n.jsx)(s.H,{children:(0,n.jsx)(h,{children:(0,n.jsx)(g,{children:(0,n.jsxs)(i.w,{children:[t,a&&!1]})})})})})})})}(0,A.default)(()=>a.e(726).then(a.bind(a,89726)).then(e=>({default:e.ReactQueryDevtools})),{loadableGenerated:{webpack:()=>[null]},ssr:!1})},83080:function(e,t,a){"use strict";a.d(t,{s:function(){return l},w:function(){return d}});var n=a(57437),o=a(2265),s=a(68680),i=a(85315),r=a(46175);let c=(0,o.createContext)(void 0);function l(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}function d(e){let{children:t}=e,[a,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(!1),[g,m]=(0,o.useState)(!1),{user:h,isAuthenticated:b}=(0,i.a)();return(0,o.useEffect)(()=>{m(!0)},[]),(0,o.useEffect)(()=>{if(!g)return;if(!b||!h){a&&(a.disconnect(),l(null),u(!1));return}let e=localStorage.getItem("auth_token"),t=(0,s.io)("ws://localhost:8080",{auth:{token:e,userId:h.id,role:h.role},transports:["websocket","polling"],timeout:2e4});return t.on("connect",()=>{console.log("Socket connected:",t.id),u(!0),t.emit("join_user_room",h.id),"agent"===h.role?t.emit("join_agent_room",h.id):"admin"===h.role&&t.emit("join_admin_room",h.organization_id)}),t.on("disconnect",e=>{console.log("Socket disconnected:",e),u(!1)}),t.on("connect_error",e=>{console.error("Socket connection error:",e),u(!1)}),t.on("new_message",e=>{(e.agentId===h.id||"admin"===h.role)&&r.ZP.success("New message from ".concat(e.leadName||e.phoneNumber))}),t.on("lead_status_changed",e=>{(e.agentId===h.id||"admin"===h.role)&&r.ZP.success("Lead ".concat(e.leadName," status changed to ").concat(e.status))}),t.on("appointment_booked",e=>{(e.agentId===h.id||"admin"===h.role)&&r.ZP.success("New appointment booked with ".concat(e.leadName))}),t.on("system_notification",e=>{switch(e.type){case"info":r.ZP.success(e.message);break;case"warning":case"error":r.ZP.error(e.message);break;default:(0,r.ZP)(e.message)}}),t.on("agent_status_changed",e=>{"admin"===h.role&&(0,r.ZP)("Agent ".concat(e.agentName," is now ").concat(e.status))}),l(t),()=>{t.disconnect(),l(null),u(!1)}},[b,h]),(0,n.jsx)(c.Provider,{value:{socket:a,connected:d,joinRoom:e=>{a&&d&&a.emit("join_room",e)},leaveRoom:e=>{a&&d&&a.emit("leave_room",e)},emit:(e,t)=>{a&&d&&a.emit(e,t)}},children:t})}},47960:function(){}},function(e){e.O(0,[353,851,438,301,296,859,688,325,805,868,971,117,744],function(){return e(e.s=73928)}),_N_E=e.O()}]);