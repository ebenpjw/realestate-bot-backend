(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{41122:function(e,t,s){Promise.resolve().then(s.bind(s,3045))},3045:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return I}});var a=s(57437),r=s(2265),n=s(85315),l=s(83080),i=s(85012),o=s(39795),c=s(61994);function d(e){let{conversations:t,selectedConversation:s,onConversationSelect:r}=e,n=e=>{switch(e){case"new":return"bg-blue-100 text-blue-800";case"qualified":return"bg-green-100 text-green-800";case"booked":return"bg-purple-100 text-purple-800";case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},l=e=>{switch(e){case"buy":return"\uD83C\uDFE0";case"rent":return"\uD83D\uDD11";case"browse":return"\uD83D\uDC40";case"invest":return"\uD83D\uDCB0";default:return"\uD83D\uDCAC"}},i=e=>{if(e.includes("ago")||e.includes("Just now"))return e;try{let t=new Date(e);return(0,o.Q)(t,{addSuffix:!0})}catch(t){return e}};return(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:t.map(e=>(0,a.jsx)("div",{onClick:()=>r(e),className:(0,c.Z)("p-4 cursor-pointer transition-colors hover:bg-gray-50",(null==s?void 0:s.id)===e.id&&"bg-primary-50 border-r-2 border-primary-500"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-10 w-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.avatar?(0,a.jsx)("img",{src:e.avatar,alt:e.leadName,className:"h-10 w-10 rounded-full"}):(0,a.jsx)("span",{className:"text-sm font-medium text-primary-700",children:e.leadName.charAt(0)})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.leadName}),(0,a.jsx)("span",{className:"text-xs",children:l(e.intent)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.unreadCount>0&&(0,a.jsx)("span",{className:"bg-primary-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount}),(0,a.jsx)("span",{className:(0,c.Z)("inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",n(e.status)),children:e.status})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:e.phoneNumber}),(0,a.jsx)("p",{className:"text-sm text-gray-600 truncate mb-1",children:e.lastMessage}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:i(e.lastMessageTime)})]})]})},e.id))})}var u=s(87735),m=s(89453),x=s(76098),h=s(59055),g=s(74610),f=s(67442),p=s(45762),y=s(45926);function b(e){let{conversation:t,messages:s,onSendMessage:n,connected:l}=e,[i,o]=(0,r.useState)(""),[d,b]=(0,r.useState)(!1),v=(0,r.useRef)(null),j=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]),(0,r.useEffect)(()=>{j.current&&(j.current.style.height="auto",j.current.style.height="".concat(j.current.scrollHeight,"px"))},[i]);let N=()=>{i.trim()&&l&&(n(i.trim()),o(""))},w=e=>{switch(e){case"sent":return"✓";case"delivered":case"read":return"✓✓";default:return""}},C=e=>{switch(e){case"lead":return t.leadName;case"bot":return"Doro (Bot)";case"agent":return"You";default:return e}},k=e=>{switch(e){case"lead":default:return"text-gray-900";case"bot":return"text-primary-600";case"agent":return"text-green-600"}};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-primary-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-primary-700",children:t.leadName.charAt(0)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:t.leadName}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:t.phoneNumber}),(0,a.jsx)("span",{className:(0,c.Z)("inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",(e=>{switch(e){case"new":return"bg-blue-100 text-blue-800";case"qualified":return"bg-green-100 text-green-800";case"booked":return"bg-purple-100 text-purple-800";case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(t.status)),children:t.status})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{className:"btn-ghost p-2",children:(0,a.jsx)(m.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"btn-ghost p-2",children:(0,a.jsx)(x.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"btn-ghost p-2",children:(0,a.jsx)(h.Z,{className:"h-5 w-5"})}),(0,a.jsxs)(p.v2,{as:"div",className:"relative",children:[(0,a.jsx)(p.v2.Button,{className:"btn-ghost p-2",children:(0,a.jsx)(g.Z,{className:"h-5 w-5"})}),(0,a.jsx)(y.u,{as:r.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsxs)(p.v2.Items,{className:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-lg bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:[(0,a.jsx)(p.v2.Item,{children:e=>{let{active:t}=e;return(0,a.jsx)("button",{className:(0,c.Z)(t?"bg-gray-100":"","block w-full px-4 py-2 text-left text-sm text-gray-700"),children:"View Lead Profile"})}}),(0,a.jsx)(p.v2.Item,{children:e=>{let{active:t}=e;return(0,a.jsx)("button",{className:(0,c.Z)(t?"bg-gray-100":"","block w-full px-4 py-2 text-left text-sm text-gray-700"),children:"Schedule Appointment"})}}),(0,a.jsx)(p.v2.Item,{children:e=>{let{active:t}=e;return(0,a.jsx)("button",{className:(0,c.Z)(t?"bg-gray-100":"","block w-full px-4 py-2 text-left text-sm text-gray-700"),children:"Export Conversation"})}})]})})]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[s.map((e,t)=>{let r="lead"===e.sender,n="bot"===e.sender,l=s[t-1],i=0===t||l&&new Date(e.timestamp).getTime()-new Date(l.timestamp).getTime()>3e5;return(0,a.jsxs)("div",{children:[i&&(0,a.jsx)("div",{className:"text-center text-xs text-gray-500 mb-4",children:(0,u.WU)(new Date(e.timestamp),"MMM d, yyyy h:mm a")}),(0,a.jsx)("div",{className:(0,c.Z)("flex",r?"justify-start":"justify-end"),children:(0,a.jsxs)("div",{className:(0,c.Z)("max-w-xs lg:max-w-md px-4 py-2 rounded-2xl",r?"bg-white text-gray-900 rounded-bl-sm":n?"bg-primary-100 text-primary-900 rounded-br-sm":"bg-primary-600 text-white rounded-br-sm"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:(0,c.Z)("text-xs font-medium",k(e.sender)),children:C(e.sender)}),e.templateName&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["Template: ",e.templateName]})]}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.message}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsx)("span",{className:"text-xs opacity-70",children:(0,u.WU)(new Date(e.timestamp),"h:mm a")}),!r&&(0,a.jsx)("span",{className:"text-xs opacity-70",children:w(e.status)})]})]})})]},e.id)}),d&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-white text-gray-900 px-4 py-2 rounded-2xl rounded-bl-sm",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,a.jsx)("div",{ref:v})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 bg-white",children:[(0,a.jsxs)("div",{className:"flex items-end space-x-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{ref:j,value:i,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())},placeholder:l?"Type a message...":"Disconnected - cannot send messages",disabled:!l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100 disabled:cursor-not-allowed",rows:1,style:{minHeight:"40px",maxHeight:"120px"}})}),(0,a.jsx)("button",{onClick:N,disabled:!i.trim()||!l,className:"btn-primary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)(f.Z,{className:"h-5 w-5"})})]}),!l&&(0,a.jsx)("p",{className:"text-xs text-red-500 mt-2",children:"Connection lost. Trying to reconnect..."})]})]})}var v=s(41556);function j(e){let{searchQuery:t,onSearchChange:s,statusFilter:r,onStatusFilterChange:n}=e;return(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(v.Z,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsx)("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",placeholder:"Search conversations...",value:t,onChange:e=>s(e.target.value)})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:[{value:"all",label:"All Status",count:0},{value:"new",label:"New",count:0},{value:"qualified",label:"Qualified",count:0},{value:"booked",label:"Booked",count:0},{value:"lost",label:"Lost",count:0}].map(e=>(0,a.jsx)("button",{onClick:()=>n(e.value),className:"px-3 py-1 text-xs font-medium rounded-full transition-colors ".concat(r===e.value?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.value))})]})}var N=s(94565),w=s(43767);let C=[{id:"1",leadId:"lead-1",leadName:"Sarah Chen",phoneNumber:"+65 9123 4567",status:"qualified",lastMessage:"I'm interested in the 3-bedroom unit at Marina Bay",lastMessageTime:"2 minutes ago",unreadCount:2,intent:"buy"},{id:"2",leadId:"lead-2",leadName:"Michael Tan",phoneNumber:"+65 9234 5678",status:"new",lastMessage:"What's the price range for 2-bedroom units?",lastMessageTime:"15 minutes ago",unreadCount:1,intent:"browse"},{id:"3",leadId:"lead-3",leadName:"Jennifer Lim",phoneNumber:"+65 9345 6789",status:"booked",lastMessage:"Confirmed for 2pm tomorrow. Thank you!",lastMessageTime:"1 hour ago",unreadCount:0,intent:"buy"}],k=[{id:"1",conversationId:"1",sender:"lead",message:"Hi, I saw your property listing online",timestamp:"2024-01-15T10:00:00Z",messageType:"text",status:"read"},{id:"2",conversationId:"1",sender:"bot",message:"Hello! I'm Doro, your personal property assistant. I'd be happy to help you find your dream home. What type of property are you looking for?",timestamp:"2024-01-15T10:00:30Z",messageType:"text",status:"read"},{id:"3",conversationId:"1",sender:"lead",message:"I'm interested in the 3-bedroom unit at Marina Bay",timestamp:"2024-01-15T10:02:00Z",messageType:"text",status:"read"}];function I(){let{user:e}=(0,n.a)(),{socket:t,connected:s}=(0,l.s)(),[o,c]=(0,r.useState)(C),[u,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(k),[g,f]=(0,r.useState)(!1),[p,y]=(0,r.useState)(""),[I,S]=(0,r.useState)("all"),[_,Z]=(0,r.useState)(!1),D=o.filter(e=>{let t=!p||e.leadName.toLowerCase().includes(p.toLowerCase())||e.phoneNumber.includes(p)||e.lastMessage.toLowerCase().includes(p.toLowerCase()),s="all"===I||e.status===I;return t&&s});return(0,r.useEffect)(()=>{if(!t||!s)return;let e=e=>{c(t=>t.map(t=>t.id===e.conversationId?{...t,lastMessage:e.message,lastMessageTime:"Just now",unreadCount:t.unreadCount+1}:t)),(null==u?void 0:u.id)===e.conversationId&&h(t=>[...t,{id:e.messageId,conversationId:e.conversationId,sender:e.sender,message:e.message,timestamp:e.timestamp,messageType:e.messageType||"text",status:"delivered"}])};return t.on("new_message",e),t.on("message_status_update",e=>{h(t=>t.map(t=>t.id===e.messageId?{...t,status:e.status}:t))}),()=>{t.off("new_message",e),t.off("message_status_update")}},[t,s,u]),(0,a.jsxs)("div",{className:"h-full flex bg-white rounded-xl shadow-apple border border-gray-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Conversations"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>Z(!_),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(v.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(N.Z,{className:"h-5 w-5"})})]})]}),_&&(0,a.jsx)(j,{searchQuery:p,onSearchChange:y,statusFilter:I,onStatusFilterChange:S}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:[D.length," conversations"]}),(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1"}),s?"Online":"Offline"]})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:g?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)(i.TK,{})}):D.length>0?(0,a.jsx)(d,{conversations:D,selectedConversation:u,onConversationSelect:e=>{m(e),c(t=>t.map(t=>t.id===e.id?{...t,unreadCount:0}:t)),h(k.filter(t=>t.conversationId===e.id))}}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500",children:[(0,a.jsx)(w.Z,{className:"h-8 w-8 mb-2"}),(0,a.jsx)("p",{className:"text-sm",children:"No conversations found"})]})})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col",children:u?(0,a.jsx)(b,{conversation:u,messages:x,onSendMessage:a=>{if(!u)return;let r={id:Date.now().toString(),conversationId:u.id,sender:"agent",message:a,timestamp:new Date().toISOString(),messageType:"text",status:"sent"};h(e=>[...e,r]),c(e=>e.map(e=>e.id===u.id?{...e,lastMessage:a,lastMessageTime:"Just now"}:e)),t&&s&&t.emit("send_message",{conversationId:u.id,leadId:u.leadId,message:a,agentId:null==e?void 0:e.id})},connected:s}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(w.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,a.jsx)("p",{className:"text-sm",children:"Choose a conversation from the list to start messaging"})]})})})]})}},85012:function(e,t,s){"use strict";s.d(t,{TK:function(){return i}});var a=s(57437);s(2265);var r=s(90535),n=s(94508);let l=(0,r.j)("animate-spin",{variants:{size:{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},variant:{default:"text-primary",muted:"text-muted-foreground",destructive:"text-destructive"}},defaultVariants:{size:"md",variant:"default"}});function i(e){let{size:t,variant:s,className:r,label:i="Loading...",...o}=e;return(0,a.jsxs)("div",{className:(0,n.cn)("flex items-center justify-center",r),role:"status","aria-label":i,...o,children:[(0,a.jsxs)("svg",{className:(0,n.cn)(l({size:t,variant:s})),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{className:"sr-only",children:i})]})}},83080:function(e,t,s){"use strict";s.d(t,{s:function(){return c},w:function(){return d}});var a=s(57437),r=s(2265),n=s(68680),l=s(85315),i=s(46175);let o=(0,r.createContext)(void 0);function c(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}function d(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),{user:h,isAuthenticated:g}=(0,l.a)();return(0,r.useEffect)(()=>{x(!0)},[]),(0,r.useEffect)(()=>{if(!m)return;if(!g||!h){s&&(s.disconnect(),c(null),u(!1));return}let e=localStorage.getItem("auth_token"),t=(0,n.io)("ws://localhost:8080",{auth:{token:e,userId:h.id,role:h.role},transports:["websocket","polling"],timeout:2e4});return t.on("connect",()=>{console.log("Socket connected:",t.id),u(!0),t.emit("join_user_room",h.id),"agent"===h.role?t.emit("join_agent_room",h.id):"admin"===h.role&&t.emit("join_admin_room",h.organization_id)}),t.on("disconnect",e=>{console.log("Socket disconnected:",e),u(!1)}),t.on("connect_error",e=>{console.error("Socket connection error:",e),u(!1)}),t.on("new_message",e=>{(e.agentId===h.id||"admin"===h.role)&&i.ZP.success("New message from ".concat(e.leadName||e.phoneNumber))}),t.on("lead_status_changed",e=>{(e.agentId===h.id||"admin"===h.role)&&i.ZP.success("Lead ".concat(e.leadName," status changed to ").concat(e.status))}),t.on("appointment_booked",e=>{(e.agentId===h.id||"admin"===h.role)&&i.ZP.success("New appointment booked with ".concat(e.leadName))}),t.on("system_notification",e=>{switch(e.type){case"info":i.ZP.success(e.message);break;case"warning":case"error":i.ZP.error(e.message);break;default:(0,i.ZP)(e.message)}}),t.on("agent_status_changed",e=>{"admin"===h.role&&(0,i.ZP)("Agent ".concat(e.agentName," is now ").concat(e.status))}),c(t),()=>{t.disconnect(),c(null),u(!1)}},[g,h]),(0,a.jsx)(o.Provider,{value:{socket:s,connected:d,joinRoom:e=>{s&&d&&s.emit("join_room",e)},leaveRoom:e=>{s&&d&&s.emit("leave_room",e)},emit:(e,t)=>{s&&d&&s.emit(e,t)}},children:t})}},94508:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(61994),r=s(53335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}}},function(e){e.O(0,[501,851,438,301,296,859,101,735,714,315,971,117,744],function(){return e(e.s=41122)}),_N_E=e.O()}]);