(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{41122:function(e,s,t){Promise.resolve().then(t.bind(t,3045))},3045:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return D}});var a=t(57437),r=t(2265),n=t(85315),l=t(83080),i=t(85012),d=t(39795),c=t(61994);function o(e){let{conversations:s,selectedConversation:t,onConversationSelect:r}=e,n=e=>{switch(e){case"new":return"bg-blue-100 text-blue-800";case"qualified":return"bg-green-100 text-green-800";case"booked":return"bg-purple-100 text-purple-800";case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},l=e=>{switch(e){case"buy":return"\uD83C\uDFE0";case"rent":return"\uD83D\uDD11";case"browse":return"\uD83D\uDC40";case"invest":return"\uD83D\uDCB0";default:return"\uD83D\uDCAC"}},i=e=>{if(e.includes("ago")||e.includes("Just now"))return e;try{let s=new Date(e);return(0,d.Q)(s,{addSuffix:!0})}catch(s){return e}};return(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:s.map(e=>(0,a.jsx)("div",{onClick:()=>r(e),className:(0,c.Z)("p-4 cursor-pointer transition-colors hover:bg-gray-50",(null==t?void 0:t.id)===e.id&&"bg-primary-50 border-r-2 border-primary-500"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-10 w-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.avatar?(0,a.jsx)("img",{src:e.avatar,alt:e.leadName,className:"h-10 w-10 rounded-full"}):(0,a.jsx)("span",{className:"text-sm font-medium text-primary-700",children:e.leadName.charAt(0)})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.leadName}),(0,a.jsx)("span",{className:"text-xs",children:l(e.intent)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.unreadCount>0&&(0,a.jsx)("span",{className:"bg-primary-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount}),(0,a.jsx)("span",{className:(0,c.Z)("inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",n(e.status)),children:e.status})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:e.phoneNumber}),(0,a.jsx)("p",{className:"text-sm text-gray-600 truncate mb-1",children:e.lastMessage}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:i(e.lastMessageTime)})]})]})},e.id))})}var m=t(87735),u=t(89453),x=t(76098),h=t(59055),g=t(74610),p=t(67442),f=t(97439),y=t(45926);function b(e){let{conversation:s,messages:t,onSendMessage:n,connected:l}=e,[i,d]=(0,r.useState)(""),[o,b]=(0,r.useState)(!1),v=(0,r.useRef)(null),j=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]),(0,r.useEffect)(()=>{j.current&&(j.current.style.height="auto",j.current.style.height="".concat(j.current.scrollHeight,"px"))},[i]);let N=()=>{i.trim()&&l&&(n(i.trim()),d(""))},w=e=>{switch(e){case"sent":return"✓";case"delivered":case"read":return"✓✓";default:return""}},C=e=>{switch(e){case"lead":return s.leadName;case"bot":return"Doro (Bot)";case"agent":return"You";default:return e}},I=e=>{switch(e){case"lead":default:return"text-gray-900";case"bot":return"text-primary-600";case"agent":return"text-green-600"}};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 bg-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 bg-primary-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-primary-700",children:s.leadName.charAt(0)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:s.leadName}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:s.phoneNumber}),(0,a.jsx)("span",{className:(0,c.Z)("inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",(e=>{switch(e){case"new":return"bg-blue-100 text-blue-800";case"qualified":return"bg-green-100 text-green-800";case"booked":return"bg-purple-100 text-purple-800";case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(s.status)),children:s.status})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{className:"btn-ghost p-2",children:(0,a.jsx)(u.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"btn-ghost p-2",children:(0,a.jsx)(x.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"btn-ghost p-2",children:(0,a.jsx)(h.Z,{className:"h-5 w-5"})}),(0,a.jsxs)(f.v2,{as:"div",className:"relative",children:[(0,a.jsx)(f.v2.Button,{className:"btn-ghost p-2",children:(0,a.jsx)(g.Z,{className:"h-5 w-5"})}),(0,a.jsx)(y.u,{as:r.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,a.jsxs)(f.v2.Items,{className:"absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-lg bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:[(0,a.jsx)(f.v2.Item,{children:e=>{let{active:s}=e;return(0,a.jsx)("button",{className:(0,c.Z)(s?"bg-gray-100":"","block w-full px-4 py-2 text-left text-sm text-gray-700"),children:"View Lead Profile"})}}),(0,a.jsx)(f.v2.Item,{children:e=>{let{active:s}=e;return(0,a.jsx)("button",{className:(0,c.Z)(s?"bg-gray-100":"","block w-full px-4 py-2 text-left text-sm text-gray-700"),children:"Schedule Appointment"})}}),(0,a.jsx)(f.v2.Item,{children:e=>{let{active:s}=e;return(0,a.jsx)("button",{className:(0,c.Z)(s?"bg-gray-100":"","block w-full px-4 py-2 text-left text-sm text-gray-700"),children:"Export Conversation"})}})]})})]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[t.map((e,s)=>{let r="lead"===e.sender,n="bot"===e.sender,l=t[s-1],i=0===s||l&&new Date(e.timestamp).getTime()-new Date(l.timestamp).getTime()>3e5;return(0,a.jsxs)("div",{children:[i&&(0,a.jsx)("div",{className:"text-center text-xs text-gray-500 mb-4",children:(0,m.WU)(new Date(e.timestamp),"MMM d, yyyy h:mm a")}),(0,a.jsx)("div",{className:(0,c.Z)("flex",r?"justify-start":"justify-end"),children:(0,a.jsxs)("div",{className:(0,c.Z)("max-w-xs lg:max-w-md px-4 py-2 rounded-2xl",r?"bg-white text-gray-900 rounded-bl-sm":n?"bg-primary-100 text-primary-900 rounded-br-sm":"bg-primary-600 text-white rounded-br-sm"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:(0,c.Z)("text-xs font-medium",I(e.sender)),children:C(e.sender)}),e.templateName&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["Template: ",e.templateName]})]}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.message}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,a.jsx)("span",{className:"text-xs opacity-70",children:(0,m.WU)(new Date(e.timestamp),"h:mm a")}),!r&&(0,a.jsx)("span",{className:"text-xs opacity-70",children:w(e.status)})]})]})})]},e.id)}),o&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-white text-gray-900 px-4 py-2 rounded-2xl rounded-bl-sm",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,a.jsx)("div",{ref:v})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 bg-white",children:[(0,a.jsxs)("div",{className:"flex items-end space-x-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("textarea",{ref:j,value:i,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())},placeholder:l?"Type a message...":"Disconnected - cannot send messages",disabled:!l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100 disabled:cursor-not-allowed",rows:1,style:{minHeight:"40px",maxHeight:"120px"}})}),(0,a.jsx)("button",{onClick:N,disabled:!i.trim()||!l,className:"btn-primary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)(p.Z,{className:"h-5 w-5"})})]}),!l&&(0,a.jsx)("p",{className:"text-xs text-red-500 mt-2",children:"Connection lost. Trying to reconnect..."})]})]})}var v=t(41556);function j(e){let{searchQuery:s,onSearchChange:t,statusFilter:r,onStatusFilterChange:n}=e;return(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(v.Z,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsx)("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",placeholder:"Search conversations...",value:s,onChange:e=>t(e.target.value)})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:[{value:"all",label:"All Status",count:0},{value:"new",label:"New",count:0},{value:"qualified",label:"Qualified",count:0},{value:"booked",label:"Booked",count:0},{value:"lost",label:"Lost",count:0}].map(e=>(0,a.jsx)("button",{onClick:()=>n(e.value),className:"px-3 py-1 text-xs font-medium rounded-full transition-colors ".concat(r===e.value?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.value))})]})}var N=t(94565),w=t(43767);let C=[{id:"1",leadId:"lead-1",leadName:"Sarah Chen",phoneNumber:"+65 9123 4567",status:"qualified",lastMessage:"I'm interested in the 3-bedroom unit at Marina Bay",lastMessageTime:"2 minutes ago",unreadCount:2,intent:"buy"},{id:"2",leadId:"lead-2",leadName:"Michael Tan",phoneNumber:"+65 9234 5678",status:"new",lastMessage:"What's the price range for 2-bedroom units?",lastMessageTime:"15 minutes ago",unreadCount:1,intent:"browse"},{id:"3",leadId:"lead-3",leadName:"Jennifer Lim",phoneNumber:"+65 9345 6789",status:"booked",lastMessage:"Confirmed for 2pm tomorrow. Thank you!",lastMessageTime:"1 hour ago",unreadCount:0,intent:"buy"}],I=[{id:"1",conversationId:"1",sender:"lead",message:"Hi, I saw your property listing online",timestamp:"2024-01-15T10:00:00Z",messageType:"text",status:"read"},{id:"2",conversationId:"1",sender:"bot",message:"Hello! I'm Doro, your personal property assistant. I'd be happy to help you find your dream home. What type of property are you looking for?",timestamp:"2024-01-15T10:00:30Z",messageType:"text",status:"read"},{id:"3",conversationId:"1",sender:"lead",message:"I'm interested in the 3-bedroom unit at Marina Bay",timestamp:"2024-01-15T10:02:00Z",messageType:"text",status:"read"}];function D(){let{user:e}=(0,n.a)(),{socket:s,connected:t}=(0,l.s)(),[d,c]=(0,r.useState)(C),[m,u]=(0,r.useState)(null),[x,h]=(0,r.useState)(I),[g,p]=(0,r.useState)(!1),[f,y]=(0,r.useState)(""),[D,T]=(0,r.useState)("all"),[k,S]=(0,r.useState)(!1),Z=d.filter(e=>{let s=!f||e.leadName.toLowerCase().includes(f.toLowerCase())||e.phoneNumber.includes(f)||e.lastMessage.toLowerCase().includes(f.toLowerCase()),t="all"===D||e.status===D;return s&&t});return(0,r.useEffect)(()=>{if(!s||!t)return;let e=e=>{c(s=>s.map(s=>s.id===e.conversationId?{...s,lastMessage:e.message,lastMessageTime:"Just now",unreadCount:s.unreadCount+1}:s)),(null==m?void 0:m.id)===e.conversationId&&h(s=>[...s,{id:e.messageId,conversationId:e.conversationId,sender:e.sender,message:e.message,timestamp:e.timestamp,messageType:e.messageType||"text",status:"delivered"}])};return s.on("new_message",e),s.on("message_status_update",e=>{h(s=>s.map(s=>s.id===e.messageId?{...s,status:e.status}:s))}),()=>{s.off("new_message",e),s.off("message_status_update")}},[s,t,m]),(0,a.jsxs)("div",{className:"h-full flex bg-white rounded-xl shadow-apple border border-gray-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Conversations"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>S(!k),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(v.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:(0,a.jsx)(N.Z,{className:"h-5 w-5"})})]})]}),k&&(0,a.jsx)(j,{searchQuery:f,onSearchChange:y,statusFilter:D,onStatusFilterChange:T}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:[Z.length," conversations"]}),(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1"}),t?"Online":"Offline"]})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:g?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)(i.TK,{})}):Z.length>0?(0,a.jsx)(o,{conversations:Z,selectedConversation:m,onConversationSelect:e=>{u(e),c(s=>s.map(s=>s.id===e.id?{...s,unreadCount:0}:s)),h(I.filter(s=>s.conversationId===e.id))}}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500",children:[(0,a.jsx)(w.Z,{className:"h-8 w-8 mb-2"}),(0,a.jsx)("p",{className:"text-sm",children:"No conversations found"})]})})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col",children:m?(0,a.jsx)(b,{conversation:m,messages:x,onSendMessage:a=>{if(!m)return;let r={id:Date.now().toString(),conversationId:m.id,sender:"agent",message:a,timestamp:new Date().toISOString(),messageType:"text",status:"sent"};h(e=>[...e,r]),c(e=>e.map(e=>e.id===m.id?{...e,lastMessage:a,lastMessageTime:"Just now"}:e)),s&&t&&s.emit("send_message",{conversationId:m.id,leadId:m.leadId,message:a,agentId:null==e?void 0:e.id})},connected:t}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(w.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),(0,a.jsx)("p",{className:"text-sm",children:"Choose a conversation from the list to start messaging"})]})})})]})}}},function(e){e.O(0,[216,592,744],function(){return e(e.s=41122)}),_N_E=e.O()}]);