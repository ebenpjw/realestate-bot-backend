(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{73928:function(t,a,e){Promise.resolve().then(e.bind(e,24042)),Promise.resolve().then(e.bind(e,86868)),Promise.resolve().then(e.t.bind(e,17129,23)),Promise.resolve().then(e.t.bind(e,6840,23)),Promise.resolve().then(e.t.bind(e,47960,23)),Promise.resolve().then(e.bind(e,14438))},24042:function(t,a,e){"use strict";e.d(a,{Providers:function(){return v}});var n=e(57437),s=e(2265),o=e(85315),i=e(83080),r=e(73965);class l{async getIntegrationStatus(t){return(await r.x.get("/dashboard/integrations/status",{params:{agentId:t}})).data.data}async getWABAIntegration(t){return(await r.x.get("/dashboard/integrations/waba",{params:{agentId:t}})).data.data}async connectWABA(t){return(await r.x.post("/dashboard/integrations/waba/connect",t)).data.data}async updateWABA(t){return(await r.x.patch("/dashboard/integrations/waba",t)).data.data}async disconnectWABA(){await r.x.post("/dashboard/integrations/waba/disconnect")}async testWABAConnection(t){return(await r.x.post("/dashboard/integrations/waba/test",{agentId:t})).data.data}async getWABAQRCode(){return(await r.x.get("/dashboard/integrations/waba/qr-code")).data.data}async getGoogleIntegration(t){return(await r.x.get("/dashboard/integrations/google",{params:{agentId:t}})).data.data}async getGoogleAuthUrl(t){return(await r.x.get("/auth/google",{params:{agentId:t}})).data}async disconnectGoogle(){await r.x.post("/dashboard/integrations/google/disconnect")}async testGoogleConnection(t){return(await r.x.post("/dashboard/integrations/google/test",{agentId:t})).data.data}async getZoomIntegration(t){return(await r.x.get("/dashboard/integrations/zoom",{params:{agentId:t}})).data.data}async getZoomAuthUrl(t){return(await r.x.get("/auth/zoom",{params:{agentId:t}})).data}async disconnectZoom(){await r.x.post("/dashboard/integrations/zoom/disconnect")}async testZoomConnection(t){return(await r.x.post("/dashboard/integrations/zoom/test",{agentId:t})).data.data}async updateZoomSettings(t){return(await r.x.patch("/dashboard/integrations/zoom/settings",t)).data.data}async getMetaBusinessIntegration(t){return(await r.x.get("/dashboard/integrations/meta",{params:{agentId:t}})).data.data}async getMetaAuthUrl(){return(await r.x.get("/dashboard/integrations/meta/auth-url")).data}async disconnectMeta(){await r.x.post("/dashboard/integrations/meta/disconnect")}async syncAllIntegrations(t){return(await r.x.post("/dashboard/integrations/sync-all",{agentId:t})).data.data}async getHealthCheck(t){return(await r.x.get("/dashboard/integrations/health",{params:{agentId:t}})).data.data}}let c=new l;var d=e(14438);let u=(0,s.createContext)(void 0);function g(t){let{children:a}=t,[e,i]=(0,s.useState)(null),[r,l]=(0,s.useState)([]),[g,m]=(0,s.useState)(!0),[h,b]=(0,s.useState)(null),{user:A,isAuthenticated:p}=(0,o.a)();(0,s.useEffect)(()=>{p&&A?y():(i(null),l([]),m(!1))},[p,A]);let y=async()=>{try{m(!0),b(null);let t=await c.getWABAIntegration(null==A?void 0:A.id);i(t),"connected"===t.status&&t.templates&&l(t.templates.map(t=>({id:t.id,name:t.name,category:t.category,status:t.status,language:t.language,content:""})))}catch(t){console.error("Failed to load WABA config:",t),b(t.message||"Failed to load WABA configuration")}finally{m(!1)}},w=(0,s.useCallback)(async t=>{try{m(!0),b(null);let a=await c.connectWABA(t);i(a),d.A.success("WABA Connected",{description:"Successfully connected WhatsApp Business API for ".concat(t.phoneNumber)}),await x()}catch(a){let t=a.message||"Failed to connect WABA";throw b(t),d.A.error("WABA Connection Failed",{description:t}),a}finally{m(!1)}},[]),f=(0,s.useCallback)(async t=>{try{m(!0),b(null);let a=await c.updateWABA(t);i(a),d.A.success("WABA Updated",{description:"WhatsApp Business API configuration updated successfully"})}catch(a){let t=a.message||"Failed to update WABA";throw b(t),d.A.error("WABA Update Failed",{description:t}),a}finally{m(!1)}},[]),v=(0,s.useCallback)(async()=>{try{m(!0),b(null),await c.disconnectWABA(),i(null),l([]),d.A.success("WABA Disconnected",{description:"WhatsApp Business API has been disconnected"})}catch(a){let t=a.message||"Failed to disconnect WABA";throw b(t),d.A.error("WABA Disconnect Failed",{description:t}),a}finally{m(!1)}},[]),C=(0,s.useCallback)(async()=>{try{let t=await c.testWABAConnection(null==A?void 0:A.id);if(t.success)return d.A.success("WABA Connection Test",{description:t.message}),!0;return d.A.error("WABA Connection Test Failed",{description:t.message}),!1}catch(t){return d.A.error("WABA Connection Test Failed",{description:t.message||"Failed to test WABA connection"}),!1}},[null==A?void 0:A.id]),x=(0,s.useCallback)(async()=>{try{if(!e||"connected"!==e.status)return;let t=await c.getWABAIntegration(null==A?void 0:A.id);t.templates&&l(t.templates.map(t=>({id:t.id,name:t.name,category:t.category,status:t.status,language:t.language,content:""})))}catch(t){console.error("Failed to refresh templates:",t),d.A.error("Failed to refresh templates",{description:t.message})}},[e,null==A?void 0:A.id]),_=(0,s.useCallback)(t=>r.find(a=>a.id===t),[r]),B={wabaConfig:e,templates:r,loading:g,error:h,connectWABA:w,updateWABA:f,disconnectWABA:v,testConnection:C,refreshTemplates:x,getTemplate:_,refreshStatus:(0,s.useCallback)(async()=>{await y()},[]),isConnected:(null==e?void 0:e.status)==="connected",hasError:!!h||(null==e?void 0:e.status)==="error"};return(0,n.jsx)(u.Provider,{value:B,children:a})}let m=(0,s.createContext)(void 0);function h(t){let{children:a}=t,[e,i]=(0,s.useState)(null),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[g,h]=(0,s.useState)(null),{user:b,isAuthenticated:A}=(0,o.a)();(0,s.useEffect)(()=>{A&&b?p():(i(null),c(null),u(!1))},[A,b]);let p=async()=>{try{u(!0),h(null);let t=(await r.x.get("/dashboard/agent/config/".concat(null==b?void 0:b.id))).data.data;if(i({id:t.id,fullName:t.full_name,email:t.email,organizationId:t.organization_id,wabaPhoneNumber:t.waba_phone_number,wabaDisplayName:t.waba_display_name,botName:t.bot_name||"Doro",googleConnected:!!t.google_email,zoomConnected:!!t.zoom_user_id,wabaConnected:!!t.waba_phone_number,workingHours:t.working_hours||{start:9,end:18,days:[1,2,3,4,5]},timezone:t.timezone||"Asia/Singapore",botPersonalityConfig:t.bot_personality_config||{},customResponses:t.custom_responses||{},totalLeads:t.total_leads||0,activeConversations:t.active_conversations||0,conversionRate:t.conversion_rate||0,averageResponseTime:t.average_response_time||0}),(null==b?void 0:b.role)==="admin"||t.organization_id)try{let a=(await r.x.get("/dashboard/organization/config/".concat(t.organization_id))).data.data;c({id:a.id,name:a.name,slug:a.slug,subscriptionTier:a.subscription_tier,settings:a.settings||{},maxAgents:a.max_agents||10,currentAgents:a.current_agents||1,features:a.features||[]})}catch(t){console.warn("Failed to load organization config:",t)}}catch(t){console.error("Failed to load agent config:",t),h(t.message||"Failed to load agent configuration")}finally{u(!1)}},y=(0,s.useCallback)(async t=>{try{u(!0),h(null);let a=(await r.x.patch("/dashboard/agent/config/".concat(null==b?void 0:b.id),t)).data.data;i(t=>t?{...t,...a}:null)}catch(t){throw h(t.message||"Failed to update agent configuration"),t}finally{u(!1)}},[null==b?void 0:b.id]),w=(0,s.useCallback)(async()=>{await p()},[]),f=(0,s.useCallback)(async t=>{await y({botPersonalityConfig:t})},[y]),v=(0,s.useCallback)(async t=>{await y({customResponses:t})},[y]),C=(0,s.useCallback)(async t=>{await y({workingHours:t})},[y]),x=(0,s.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;if(!e)return!1;let{workingHours:a,timezone:n}=e,s=new Date(t.toLocaleString("en-US",{timeZone:n})),o=s.getDay(),i=s.getHours();return a.days.includes(o)&&i>=a.start&&i<a.end},[e]),_=(0,s.useCallback)(()=>{if(!e)return null;let{workingHours:t,timezone:a}=e,n=new Date;for(let e=0;e<7;e++){let s=new Date(n);s.setDate(n.getDate()+e);let o=new Date(s.toLocaleString("en-US",{timeZone:a})),i=o.getDay();if(t.days.includes(i)&&(o.setHours(t.start,0,0,0),0===e&&n.getHours()>=t.start&&o.setTime(n.getTime()+36e5),o.getHours()<t.end))return o}return null},[e]),B=(0,s.useCallback)(()=>{if(!e||!l)return!1;let t="basic"===l.subscriptionTier?50:"pro"===l.subscriptionTier?200:1e3;return e.activeConversations<t},[e,l]);return(0,n.jsx)(m.Provider,{value:{agentConfig:e,organizationConfig:l,loading:d,error:g,updateAgentConfig:y,refreshAgentConfig:w,updateBotPersonality:f,updateCustomResponses:v,updateWorkingHours:C,isWithinWorkingHours:x,getNextAvailableSlot:_,canCreateNewConversation:B},children:a})}var b=e(31800),A=e(29827),p=e(3204),y=e(25922),w=e(20993);let f=new b.S({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:(t,a)=>(null==a?void 0:a.status)!==401&&(null==a?void 0:a.status)!==403&&t<3,refetchOnWindowFocus:!1,refetchOnReconnect:"always"},mutations:{retry:1}}});function v(t){let{children:a}=t;return(0,n.jsx)(A.aH,{client:f,children:(0,n.jsx)(y.f,{attribute:"class",defaultTheme:"light",enableSystem:!0,disableTransitionOnChange:!0,children:(0,n.jsx)(w.pn,{delayDuration:300,children:(0,n.jsx)(o.H,{children:(0,n.jsx)(h,{children:(0,n.jsx)(g,{children:(0,n.jsxs)(i.w,{children:[a,(0,n.jsx)(p.t,{initialIsOpen:!1,buttonPosition:"bottom-left",position:"bottom"})]})})})})})})})}},47960:function(){}},function(t){t.O(0,[353,216,592,744],function(){return t(t.s=73928)}),_N_E=t.O()}]);