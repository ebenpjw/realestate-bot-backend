"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[315],{73965:function(e,t,r){r.d(t,{x:function(){return u}});var a=r(83464),s=r(14438);class o extends Error{constructor(e,t="UNKNOWN_ERROR",r=500,a){super(e),this.name="AppError",this.code=t,this.status=r,this.details=a}}class n extends o{constructor(e="Network error occurred"){super(e,"NETWORK_ERROR",0),this.name="NetworkError"}}class i{setupInterceptors(){this.client.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e.headers["X-Request-ID"]=crypto.randomUUID(),e.headers["X-Request-Time"]=new Date().toISOString(),e},e=>Promise.reject(this.normalizeError(e))),this.client.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){r._retry=!0;try{this.refreshPromise||(this.refreshPromise=this.refreshToken());let e=await this.refreshPromise;if(this.refreshPromise=null,e&&r.headers)return r.headers.Authorization="Bearer ".concat(e),this.client(r)}catch(e){return this.refreshPromise=null,this.handleAuthFailure(),Promise.reject(this.normalizeError(e))}}if(!e.response){let t=this.createNetworkError(e);return this.showErrorToast(t,r),Promise.reject(t)}let a=this.normalizeError(e);return this.showErrorToast(a,r),Promise.reject(a)})}async refreshToken(){try{let e=(await this.client.post("/frontend-auth/refresh")).data.token;return localStorage.setItem("auth_token",e),e}catch(e){throw e}}handleAuthFailure(){localStorage.removeItem("auth_token"),window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")}normalizeError(e){let t=function(e){if(e.response){let{status:t,data:r}=e.response;return new o((null==r?void 0:r.error)||(null==r?void 0:r.message)||"An error occurred",(null==r?void 0:r.code)||"HTTP_".concat(t),t,r)}return e.request?new n("Unable to connect to server"):e instanceof o?e:new o(e.message||"An unexpected error occurred")}(e);return{message:t.message,status:t.status,code:t.code,details:t.details}}createNetworkError(e){return{message:"Network error. Please check your connection and try again.",code:"NETWORK_ERROR"}}showErrorToast(e,t){!["/auth/me","/auth/refresh","/frontend-auth/refresh"].some(e=>{var r;return null==t?void 0:null===(r=t.url)||void 0===r?void 0:r.includes(e)})&&e.status&&e.status>=400&&s.A.error(e.message,{id:"error-".concat(e.status,"-").concat(null==t?void 0:t.url)})}getErrorMessage(e){let t=e.response;if((null==t?void 0:t.data)&&"object"==typeof t.data){let e=t.data;if(e.message)return e.message;if(e.error)return e.error;if(e.detail)return e.detail}switch(null==t?void 0:t.status){case 400:return"Bad request. Please check your input.";case 401:return"Authentication required. Please log in.";case 403:return"Access denied. You don't have permission for this action.";case 404:return"Resource not found.";case 409:return"Conflict. The resource already exists or is in use.";case 422:return"Validation error. Please check your input.";case 429:return"Too many requests. Please try again later.";case 500:return"Server error. Please try again later.";case 502:return"Bad gateway. The server is temporarily unavailable.";case 503:return"Service unavailable. Please try again later.";case 504:return"Gateway timeout. The request took too long to process.";default:return e.message||"An unexpected error occurred."}}async get(e,t){return this.client.get(e,t)}async post(e,t,r){return this.client.post(e,t,r)}async put(e,t,r){return this.client.put(e,t,r)}async patch(e,t,r){return this.client.patch(e,t,r)}async delete(e,t){return this.client.delete(e,t)}async uploadFile(e,t,r){let a=new FormData;return a.append("file",t),this.client.post(e,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{r&&e.total&&r(Math.round(100*e.loaded/e.total))}})}constructor(){this.refreshPromise=null,this.client=a.Z.create({baseURL:"".concat("http://localhost:8080/api","/api"),timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!1}),this.setupInterceptors()}}let u=new i},85315:function(e,t,r){r.d(t,{H:function(){return d},a:function(){return h}});var a=r(57437),s=r(2265),o=r(99376),n=r(73965);class i{async login(e,t){return(await n.x.post("/frontend-auth/login",{email:e,password:t})).data}async logout(){await n.x.post("/frontend-auth/logout")}async getCurrentUser(){return(await n.x.get("/frontend-auth/me")).data.data}async refreshToken(){return(await n.x.post("/frontend-auth/refresh")).data}async requestPasswordReset(e){await n.x.post("/auth/forgot-password",{email:e})}async resetPassword(e,t){await n.x.post("/auth/reset-password",{token:e,password:t})}async changePassword(e,t){await n.x.post("/frontend-auth/change-password",{current_password:e,new_password:t})}async updateProfile(e){return(await n.x.patch("/frontend-auth/profile",e)).data.data}async initiateGoogleAuth(e){return(await n.x.get("/auth/google?agentId=".concat(e))).data}async initiateZoomAuth(e){return(await n.x.get("/auth/zoom?agentId=".concat(e))).data}async getOAuthStatus(e){return(await n.x.get("/auth/oauth-status/".concat(e))).data}}let u=new i;var c=r(14438);let l=(0,s.createContext)(void 0);function h(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:t}=e,[r,n]=(0,s.useState)(null),[i,h]=(0,s.useState)(!0),[d,p]=(0,s.useState)(null),f=(0,o.useRouter)();(0,s.useEffect)(()=>{g()},[]),(0,s.useEffect)(()=>()=>{d&&clearTimeout(d)},[d]);let g=async()=>{try{let e=localStorage.getItem("auth_token");if(!e){h(!1);return}if(m(e))try{await y()}catch(e){console.error("Token refresh failed:",e),await v();return}let t=await u.getCurrentUser();n(t),w(e)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("auth_token")}finally{h(!1)}},m=e=>{try{let t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3;return t.exp<r+300}catch(e){return!0}},w=e=>{try{let t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3,a=(t.exp-r-300)*1e3;if(a>0){d&&clearTimeout(d);let e=setTimeout(async()=>{try{await y()}catch(e){console.error("Automatic token refresh failed:",e),await v()}},a);p(e)}}catch(e){console.error("Failed to setup token refresh:",e)}},y=async()=>{try{let e=await u.refreshToken();return localStorage.setItem("auth_token",e.token),n(e.user),w(e.token),e.token}catch(e){throw e}},k=(0,s.useCallback)(async(e,t)=>{try{h(!0);let r=await u.login(e,t);localStorage.setItem("auth_token",r.token),n(r.user),w(r.token),c.A.success("Welcome back!",{description:"Logged in as ".concat(r.user.full_name)}),"admin"===r.user.role?f.push("/admin/dashboard"):f.push("/agent/dashboard")}catch(e){throw c.A.error("Login failed",{description:e.message||"Please check your credentials and try again"}),e}finally{h(!1)}},[f]),v=(0,s.useCallback)(async()=>{try{await u.logout()}catch(e){console.error("Logout error:",e)}finally{d&&(clearTimeout(d),p(null)),localStorage.removeItem("auth_token"),n(null),f.push("/auth/login"),c.A.success("Logged out successfully",{description:"You have been securely logged out"})}},[f,d]),P=(0,s.useCallback)(async()=>{try{let e=await u.getCurrentUser();n(e)}catch(e){console.error("Failed to refresh user:",e),v()}},[v]),A=(0,s.useCallback)(e=>!!r&&(r.permissions.includes(e)||"admin"===r.role),[r]),E=(0,s.useMemo)(()=>({user:r,loading:i,login:k,logout:v,refreshUser:P,isAuthenticated:!!r,hasPermission:A,isAgent:(null==r?void 0:r.role)==="agent",isAdmin:(null==r?void 0:r.role)==="admin"}),[r,i,k,v,P,A]);return(0,a.jsx)(l.Provider,{value:E,children:t})}}}]);