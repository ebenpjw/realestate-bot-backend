"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{85012:function(e,t,s){s.d(t,{TK:function(){return c}});var a=s(57437);s(2265);var n=s(90535),o=s(94508);let i=(0,n.j)("animate-spin",{variants:{size:{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},variant:{default:"text-primary",muted:"text-muted-foreground",destructive:"text-destructive"}},defaultVariants:{size:"md",variant:"default"}});function c(e){let{size:t,variant:s,className:n,label:c="Loading...",...r}=e;return(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center justify-center",n),role:"status","aria-label":c,...r,children:[(0,a.jsxs)("svg",{className:(0,o.cn)(i({size:t,variant:s})),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{className:"sr-only",children:c})]})}},72099:function(e,t,s){s.d(t,{RW:function(){return u},Us:function(){return d},n$:function(){return m}});var a=s(57437),n=s(83080),o=s(6638),i=s(47842),c=s(1442),r=s(2907),l=s(61994);function d(e){let{showText:t=!0,size:s="md",className:r}=e,{connected:d}=(0,n.s)(),{metrics:m}=(0,o.k)(),u={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},g=d?m.systemAlerts>0?{icon:i.Z,color:"text-yellow-500",bgColor:"bg-yellow-100",text:"Connected",description:"".concat(m.systemAlerts," system alert").concat(m.systemAlerts>1?"s":"")}:{icon:c.Z,color:"text-green-500",bgColor:"bg-green-100",text:"Connected",description:"All systems operational"}:{icon:i.Z,color:"text-red-500",bgColor:"bg-red-100",text:"Disconnected",description:"Real-time features unavailable"},x=g.icon;return(0,a.jsxs)("div",{className:(0,l.Z)("flex items-center space-x-2",r),children:[(0,a.jsx)("div",{className:(0,l.Z)("flex items-center justify-center rounded-full p-1",g.bgColor),children:(0,a.jsx)(x,{className:(0,l.Z)(u[s],g.color)})}),t&&(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:(0,l.Z)("font-medium",{sm:"text-xs",md:"text-sm",lg:"text-base"}[s],g.color),children:g.text}),g.description&&(0,a.jsx)("span",{className:(0,l.Z)("text-gray-500","text-xs"),children:g.description})]}),d&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:(0,l.Z)("absolute rounded-full animate-ping",g.bgColor,u[s])}),(0,a.jsx)("div",{className:(0,l.Z)("relative rounded-full",g.bgColor,u[s])})]})]})}function m(e){let{className:t}=e,{metrics:s,connected:n}=(0,o.k)();return n?(0,a.jsxs)("div",{className:(0,l.Z)("grid grid-cols-2 md:grid-cols-4 gap-4",t),children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:s.activeConversations}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Active Chats"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:s.newLeads}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"New Leads"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:s.pendingAppointments}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Appointments"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-semibold text-gray-900",children:[Math.round(s.apiUsage.total),"%"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"API Usage"})]})]}):(0,a.jsxs)("div",{className:(0,l.Z)("text-center py-4",t),children:[(0,a.jsx)(r.Z,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Real-time data unavailable"})]})}function u(e){let{className:t}=e,{notifications:s}=(0,o.k)(),n=s.slice(0,5);return(0,a.jsxs)("div",{className:(0,l.Z)("space-y-3",t),children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Live Activity"}),n.length>0?(0,a.jsx)("div",{className:"space-y-2",children:n.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-2 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("div",{className:(0,l.Z)("flex-shrink-0 w-2 h-2 rounded-full mt-2","success"===e.type&&"bg-green-400","error"===e.type&&"bg-red-400","warning"===e.type&&"bg-yellow-400","info"===e.type&&"bg-blue-400")}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 truncate",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.timestamp.toLocaleTimeString()})]})]},e.id))}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No recent activity"})]})}},6638:function(e,t,s){s.d(t,{k:function(){return c}});var a=s(2265),n=s(83080),o=s(85315),i=s(14438);function c(){let{socket:e,connected:t}=(0,n.s)(),{user:s}=(0,o.a)(),[c,r]=(0,a.useState)([]),[l,d]=(0,a.useState)({activeConversations:0,newLeads:0,pendingAppointments:0,systemAlerts:0,apiUsage:{whatsapp:0,openai:0,total:0}}),m=(0,a.useCallback)(e=>{let t={...e,id:Date.now().toString(),timestamp:new Date,read:!1};switch(r(e=>[t,...e.slice(0,49)]),e.type){case"success":i.A.success(e.title,{description:e.message});break;case"error":i.A.error(e.title,{description:e.message});break;case"warning":i.A.warning(e.title,{description:e.message});break;default:i.A.info(e.title,{description:e.message})}},[]),u=(0,a.useCallback)(e=>{r(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},[]),g=(0,a.useCallback)(()=>{r(e=>e.map(e=>({...e,read:!0})))},[]),x=(0,a.useCallback)(()=>{r([])},[]);(0,a.useEffect)(()=>{if(e&&t&&s)return e.on("new_message",e=>{m({type:"info",title:"New Message",message:"Message from ".concat(e.leadName||e.phoneNumber),actionUrl:"/agent/conversations/".concat(e.conversationId),data:e}),d(e=>({...e,activeConversations:e.activeConversations+1}))}),e.on("new_lead",e=>{m({type:"success",title:"New Lead",message:"New lead: ".concat(e.leadName||e.phoneNumber),actionUrl:"/agent/leads/".concat(e.leadId),data:e}),d(e=>({...e,newLeads:e.newLeads+1}))}),e.on("appointment_booked",e=>{m({type:"success",title:"Appointment Booked",message:"Appointment scheduled with ".concat(e.leadName),actionUrl:"/agent/conversations/".concat(e.conversationId),data:e}),d(e=>({...e,pendingAppointments:e.pendingAppointments+1}))}),e.on("lead_status_changed",e=>{m({type:"info",title:"Lead Status Updated",message:"".concat(e.leadName," status changed to ").concat(e.status),actionUrl:"/agent/leads/".concat(e.leadId),data:e})}),e.on("conversation_ended",e=>{d(e=>({...e,activeConversations:Math.max(0,e.activeConversations-1)}))}),e.on("system_alert",e=>{m({type:e.severity||"warning",title:"System Alert",message:e.message,data:e}),d(e=>({...e,systemAlerts:e.systemAlerts+1}))}),e.on("api_usage_update",e=>{d(t=>({...t,apiUsage:{whatsapp:e.whatsapp||t.apiUsage.whatsapp,openai:e.openai||t.apiUsage.openai,total:e.total||t.apiUsage.total}}))}),"admin"===s.role&&(e.on("agent_status_changed",e=>{m({type:"info",title:"Agent Status Changed",message:"".concat(e.agentName," is now ").concat(e.status),actionUrl:"/admin/agents/".concat(e.agentId),data:e})}),e.on("cost_alert",e=>{m({type:"warning",title:"Cost Alert",message:"".concat(e.service," costs are at ").concat(e.percentage,"% of budget"),actionUrl:"/admin/costs",data:e})}),e.on("waba_status_changed",e=>{m({type:"connected"===e.status?"success":"error",title:"WABA Status Changed",message:"".concat(e.agentName,"'s WhatsApp Business account is ").concat(e.status),actionUrl:"/admin/waba",data:e})})),e.on("metrics_update",e=>{d(t=>({...t,...e}))}),()=>{e.off("new_message"),e.off("new_lead"),e.off("appointment_booked"),e.off("lead_status_changed"),e.off("conversation_ended"),e.off("system_alert"),e.off("api_usage_update"),e.off("agent_status_changed"),e.off("cost_alert"),e.off("waba_status_changed"),e.off("metrics_update")}},[e,t,s,m]),(0,a.useEffect)(()=>{e&&t&&s&&e.emit("request_metrics",{userId:s.id,role:s.role})},[e,t,s]);let p=c.filter(e=>!e.read).length;return{notifications:c,metrics:l,unreadCount:p,addNotification:m,markAsRead:u,markAllAsRead:g,clearNotifications:x,connected:t}}},83080:function(e,t,s){s.d(t,{s:function(){return l},w:function(){return d}});var a=s(57437),n=s(2265),o=s(68680),i=s(85315),c=s(46175);let r=(0,n.createContext)(void 0);function l(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}function d(e){let{children:t}=e,[s,l]=(0,n.useState)(null),[d,m]=(0,n.useState)(!1),[u,g]=(0,n.useState)(!1),{user:x,isAuthenticated:p}=(0,i.a)();return(0,n.useEffect)(()=>{g(!0)},[]),(0,n.useEffect)(()=>{if(!u)return;if(!p||!x){s&&(s.disconnect(),l(null),m(!1));return}let e=localStorage.getItem("auth_token"),t=(0,o.io)("ws://localhost:8080",{auth:{token:e,userId:x.id,role:x.role},transports:["websocket","polling"],timeout:2e4});return t.on("connect",()=>{console.log("Socket connected:",t.id),m(!0),t.emit("join_user_room",x.id),"agent"===x.role?t.emit("join_agent_room",x.id):"admin"===x.role&&t.emit("join_admin_room",x.organization_id)}),t.on("disconnect",e=>{console.log("Socket disconnected:",e),m(!1)}),t.on("connect_error",e=>{console.error("Socket connection error:",e),m(!1)}),t.on("new_message",e=>{(e.agentId===x.id||"admin"===x.role)&&c.ZP.success("New message from ".concat(e.leadName||e.phoneNumber))}),t.on("lead_status_changed",e=>{(e.agentId===x.id||"admin"===x.role)&&c.ZP.success("Lead ".concat(e.leadName," status changed to ").concat(e.status))}),t.on("appointment_booked",e=>{(e.agentId===x.id||"admin"===x.role)&&c.ZP.success("New appointment booked with ".concat(e.leadName))}),t.on("system_notification",e=>{switch(e.type){case"info":c.ZP.success(e.message);break;case"warning":case"error":c.ZP.error(e.message);break;default:(0,c.ZP)(e.message)}}),t.on("agent_status_changed",e=>{"admin"===x.role&&(0,c.ZP)("Agent ".concat(e.agentName," is now ").concat(e.status))}),l(t),()=>{t.disconnect(),l(null),m(!1)}},[p,x]),(0,a.jsx)(r.Provider,{value:{socket:s,connected:d,joinRoom:e=>{s&&d&&s.emit("join_room",e)},leaveRoom:e=>{s&&d&&s.emit("leave_room",e)},emit:(e,t)=>{s&&d&&s.emit(e,t)}},children:t})}}}]);