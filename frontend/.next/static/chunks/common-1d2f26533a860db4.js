"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[592],{85012:function(e,t,s){s.d(t,{TK:function(){return o}});var a=s(57437);s(2265);var r=s(90535),n=s(94508);let i=(0,r.j)("animate-spin",{variants:{size:{sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},variant:{default:"text-primary",muted:"text-muted-foreground",destructive:"text-destructive"}},defaultVariants:{size:"md",variant:"default"}});function o(e){let{size:t,variant:s,className:r,label:o="Loading...",...l}=e;return(0,a.jsxs)("div",{className:(0,n.cn)("flex items-center justify-center",r),role:"status","aria-label":o,...l,children:[(0,a.jsxs)("svg",{className:(0,n.cn)(i({size:t,variant:s})),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{className:"sr-only",children:o})]})}},86868:function(e,t,s){s.d(t,{OfflineIndicator:function(){return f},PWAInstallPrompt:function(){return p},y:function(){return g}});var a=s(57437),r=s(2265),n=s(14438);function i(){let[e,t]=(0,r.useState)({isInstallable:!1,isInstalled:!1,isOffline:!1,isUpdateAvailable:!1,notificationPermission:"default",pushSubscription:null}),[s,a]=(0,r.useState)(null),[i,o]=(0,r.useState)(null),l=(0,r.useCallback)(async()=>{if("serviceWorker"in navigator)try{let e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return o(e),e.addEventListener("updatefound",()=>{let s=e.installing;s&&s.addEventListener("statechange",()=>{"installed"===s.state&&navigator.serviceWorker.controller&&(t(e=>({...e,isUpdateAvailable:!0})),n.A.info("App Update Available",{description:"A new version is ready. Refresh to update.",action:{label:"Refresh",onClick:()=>window.location.reload()}}))})}),console.log("Service Worker registered successfully"),e}catch(e){console.error("Service Worker registration failed:",e)}return null},[]),c=(0,r.useCallback)(async()=>{if(s)try{await s.prompt();let e=await s.userChoice;"accepted"===e.outcome&&(t(e=>({...e,isInstalled:!0,isInstallable:!1})),a(null),n.A.success("App Installed",{description:"PropertyHub has been added to your home screen!"}))}catch(e){console.error("PWA installation failed:",e),n.A.error("Installation Failed",{description:"Unable to install the app. Please try again."})}},[s]),d=(0,r.useCallback)(async()=>{if("Notification"in window)try{let e=await Notification.requestPermission();return t(t=>({...t,notificationPermission:e})),"granted"===e?n.A.success("Notifications Enabled",{description:"You will now receive push notifications."}):n.A.error("Notifications Denied",{description:"You can enable notifications in your browser settings."}),e}catch(e){console.error("Notification permission request failed:",e)}return"denied"},[]),u=(0,r.useCallback)(async()=>{if(!i)return console.error("Service Worker not registered"),null;try{let e=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"your-vapid-public-key"});return t(t=>({...t,pushSubscription:e})),await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify(e)}),n.A.success("Push Notifications Enabled",{description:"You will receive real-time updates."}),e}catch(e){return console.error("Push subscription failed:",e),n.A.error("Push Notifications Failed",{description:"Unable to enable push notifications."}),null}},[i]),m=(0,r.useCallback)(async()=>{if(e.pushSubscription)try{await e.pushSubscription.unsubscribe(),t(e=>({...e,pushSubscription:null})),await fetch("/api/push/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}}),n.A.success("Push Notifications Disabled")}catch(e){console.error("Push unsubscription failed:",e)}},[e.pushSubscription]),h=(0,r.useCallback)(()=>{let e=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://");t(t=>({...t,isInstalled:e}))},[]);return(0,r.useEffect)(()=>{l(),h(),"Notification"in window&&t(e=>({...e,notificationPermission:Notification.permission}));let e=e=>{e.preventDefault(),a(e),t(e=>({...e,isInstallable:!0}))},s=()=>{t(e=>({...e,isInstalled:!0,isInstallable:!1})),a(null),n.A.success("App Installed Successfully!")},r=()=>{t(e=>({...e,isOffline:!1})),n.A.success("Back Online",{description:"Connection restored. Syncing data..."})},i=()=>{t(e=>({...e,isOffline:!0})),n.A.warning("You're Offline",{description:"Some features may be limited."})};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",s),window.addEventListener("online",r),window.addEventListener("offline",i),t(e=>({...e,isOffline:!navigator.onLine})),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",s),window.removeEventListener("online",r),window.removeEventListener("offline",i)}},[l,h]),(0,r.useEffect)(()=>{i&&i.pushManager.getSubscription().then(e=>{t(t=>({...t,pushSubscription:e}))}).catch(console.error)},[i]),{...e,installPWA:c,requestNotificationPermission:d,subscribeToPush:u,unsubscribeFromPush:m,serviceWorkerRegistration:i}}var o=s(32342),l=s(77165),c=s(2907),d=s(23121),u=s(46217),m=s(62869),h=s(66070);function p(e){let{onDismiss:t}=e,{isInstallable:s,isInstalled:n,isOffline:p,notificationPermission:f,installPWA:g,requestNotificationPermission:x,subscribeToPush:v}=i(),[y,w]=(0,r.useState)(!1),[b,N]=(0,r.useState)("install"),j=()=>{w(!0),null==t||t()},k=async()=>{await g(),N("notifications")},A=async()=>{"granted"===await x()&&await v(),N("complete")};return y||n||!s?null:(0,a.jsx)("div",{className:"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:w-96",children:(0,a.jsxs)(h.Zb,{className:"p-6 shadow-lg border-2 border-primary-200 bg-gradient-to-br from-primary-50 to-blue-50",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-primary-100 rounded-lg",children:(0,a.jsx)(o.Z,{className:"h-6 w-6 text-primary-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["install"===b&&"Install PropertyHub","notifications"===b&&"Enable Notifications","complete"===b&&"Setup Complete!"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["install"===b&&"Get the full app experience","notifications"===b&&"Stay updated with real-time alerts","complete"===b&&"You're all set to go!"]})]})]}),(0,a.jsx)("button",{onClick:j,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(l.Z,{className:"h-5 w-5"})})]}),"install"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-center",children:[(0,a.jsxs)("div",{className:"p-3 bg-white rounded-lg",children:[(0,a.jsx)(c.Z,{className:"h-6 w-6 text-green-500 mx-auto mb-1"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Works Offline"})]}),(0,a.jsxs)("div",{className:"p-3 bg-white rounded-lg",children:[(0,a.jsx)(d.Z,{className:"h-6 w-6 text-blue-500 mx-auto mb-1"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Push Notifications"})]}),(0,a.jsxs)("div",{className:"p-3 bg-white rounded-lg",children:[(0,a.jsx)(o.Z,{className:"h-6 w-6 text-purple-500 mx-auto mb-1"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Native Feel"})]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)(m.z,{variant:"default",onClick:k,className:"flex-1",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Install App"]}),(0,a.jsx)(m.z,{variant:"outline",onClick:j,className:"px-4",children:"Later"})]})]}),"notifications"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-white rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(d.Z,{className:"h-8 w-8 text-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Real-time Updates"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Get notified about new leads, messages, and appointments instantly."})]})]})}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)(m.z,{variant:"default",onClick:A,className:"flex-1",disabled:"denied"===f,children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Enable Notifications"]}),(0,a.jsx)(m.z,{variant:"outline",onClick:()=>{N("complete")},className:"px-4",children:"Skip"})]}),"denied"===f&&(0,a.jsx)("p",{className:"text-xs text-red-600 text-center",children:"Notifications are blocked. You can enable them in your browser settings."})]}),"complete"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,a.jsx)("svg",{className:"h-8 w-8 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"You're all set!"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"PropertyHub is now installed and ready to use. Enjoy the enhanced experience!"})]}),(0,a.jsx)(m.z,{variant:"default",onClick:j,className:"w-full",children:"Get Started"})]}),p&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 bg-yellow-400 rounded-full"}),(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:"You're currently offline. The app will sync when connection is restored."})]})})]})})}function f(){let{isOffline:e}=i();return e?(0,a.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-500 text-white text-center py-2 text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 bg-white rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"You're offline - Some features may be limited"})]})}):null}function g(){let{isInstalled:e,isOffline:t,notificationPermission:s,pushSubscription:r,requestNotificationPermission:n,subscribeToPush:o,unsubscribeFromPush:l}=i();return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"App Status"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Installation"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e?"App is installed":"Running in browser"})]}),(0,a.jsx)("div",{className:"h-3 w-3 rounded-full ".concat(e?"bg-green-400":"bg-gray-400")})]})}),(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Connection"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:t?"Offline":"Online"})]}),(0,a.jsx)("div",{className:"h-3 w-3 rounded-full ".concat(t?"bg-red-400":"bg-green-400")})]})}),(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Notifications"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"granted"===s?"Enabled":"denied"===s?"Blocked":"Not set"})]}),(0,a.jsx)("div",{className:"h-3 w-3 rounded-full ".concat("granted"===s?"bg-green-400":"denied"===s?"bg-red-400":"bg-yellow-400")})]})}),(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"Push Notifications"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:r?"Active":"Inactive"})]}),(0,a.jsx)("div",{className:"h-3 w-3 rounded-full ".concat(r?"bg-green-400":"bg-gray-400")})]})})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:["granted"!==s&&(0,a.jsx)(m.z,{variant:"outline",onClick:n,size:"sm",children:"Enable Notifications"}),"granted"===s&&!r&&(0,a.jsx)(m.z,{variant:"outline",onClick:o,size:"sm",children:"Enable Push Notifications"}),r&&(0,a.jsx)(m.z,{variant:"outline",onClick:l,size:"sm",children:"Disable Push Notifications"})]})]})}},72099:function(e,t,s){s.d(t,{RW:function(){return m},Us:function(){return d},n$:function(){return u}});var a=s(57437),r=s(83080),n=s(6638),i=s(47842),o=s(1442),l=s(2907),c=s(61994);function d(e){let{showText:t=!0,size:s="md",className:l}=e,{connected:d}=(0,r.s)(),{metrics:u}=(0,n.k)(),m={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},h=d?u.systemAlerts>0?{icon:i.Z,color:"text-yellow-500",bgColor:"bg-yellow-100",text:"Connected",description:"".concat(u.systemAlerts," system alert").concat(u.systemAlerts>1?"s":"")}:{icon:o.Z,color:"text-green-500",bgColor:"bg-green-100",text:"Connected",description:"All systems operational"}:{icon:i.Z,color:"text-red-500",bgColor:"bg-red-100",text:"Disconnected",description:"Real-time features unavailable"},p=h.icon;return(0,a.jsxs)("div",{className:(0,c.Z)("flex items-center space-x-2",l),children:[(0,a.jsx)("div",{className:(0,c.Z)("flex items-center justify-center rounded-full p-1",h.bgColor),children:(0,a.jsx)(p,{className:(0,c.Z)(m[s],h.color)})}),t&&(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:(0,c.Z)("font-medium",{sm:"text-xs",md:"text-sm",lg:"text-base"}[s],h.color),children:h.text}),h.description&&(0,a.jsx)("span",{className:(0,c.Z)("text-gray-500","text-xs"),children:h.description})]}),d&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:(0,c.Z)("absolute rounded-full animate-ping",h.bgColor,m[s])}),(0,a.jsx)("div",{className:(0,c.Z)("relative rounded-full",h.bgColor,m[s])})]})]})}function u(e){let{className:t}=e,{metrics:s,connected:r}=(0,n.k)();return r?(0,a.jsxs)("div",{className:(0,c.Z)("grid grid-cols-2 md:grid-cols-4 gap-4",t),children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:s.activeConversations}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Active Chats"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:s.newLeads}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"New Leads"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:s.pendingAppointments}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Appointments"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-semibold text-gray-900",children:[Math.round(s.apiUsage.total),"%"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"API Usage"})]})]}):(0,a.jsxs)("div",{className:(0,c.Z)("text-center py-4",t),children:[(0,a.jsx)(l.Z,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Real-time data unavailable"})]})}function m(e){let{className:t}=e,{notifications:s}=(0,n.k)(),r=s.slice(0,5);return(0,a.jsxs)("div",{className:(0,c.Z)("space-y-3",t),children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Live Activity"}),r.length>0?(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-2 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("div",{className:(0,c.Z)("flex-shrink-0 w-2 h-2 rounded-full mt-2","success"===e.type&&"bg-green-400","error"===e.type&&"bg-red-400","warning"===e.type&&"bg-yellow-400","info"===e.type&&"bg-blue-400")}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 truncate",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.timestamp.toLocaleTimeString()})]})]},e.id))}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No recent activity"})]})}},62869:function(e,t,s){s.d(t,{z:function(){return c}});var a=s(57437),r=s(2265),n=s(37053),i=s(90535),o=s(94508);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,a.jsx)(u,{className:(0,o.cn)(l({variant:r,size:i,className:s})),ref:t,...d})});c.displayName="Button"},66070:function(e,t,s){s.d(t,{Zb:function(){return i}});var a=s(57437),r=s(2265),n=s(94508);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...r})});i.displayName="Card",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},95186:function(e,t,s){s.d(t,{I:function(){return i}});var a=s(57437),r=s(2265),n=s(94508);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},73965:function(e,t,s){s.d(t,{x:function(){return l}});var a=s(83464),r=s(14438);class n extends Error{constructor(e,t="UNKNOWN_ERROR",s=500,a){super(e),this.name="AppError",this.code=t,this.status=s,this.details=a}}class i extends n{constructor(e="Network error occurred"){super(e,"NETWORK_ERROR",0),this.name="NetworkError"}}class o{setupInterceptors(){this.client.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e.headers["X-Request-ID"]=crypto.randomUUID(),e.headers["X-Request-Time"]=new Date().toISOString(),e},e=>Promise.reject(this.normalizeError(e))),this.client.interceptors.response.use(e=>e,async e=>{var t;let s=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!s._retry){s._retry=!0;try{this.refreshPromise||(this.refreshPromise=this.refreshToken());let e=await this.refreshPromise;if(this.refreshPromise=null,e&&s.headers)return s.headers.Authorization="Bearer ".concat(e),this.client(s)}catch(e){return this.refreshPromise=null,this.handleAuthFailure(),Promise.reject(this.normalizeError(e))}}if(!e.response){let t=this.createNetworkError(e);return this.showErrorToast(t,s),Promise.reject(t)}let a=this.normalizeError(e);return this.showErrorToast(a,s),Promise.reject(a)})}async refreshToken(){try{let e=(await this.client.post("/frontend-auth/refresh")).data.token;return localStorage.setItem("auth_token",e),e}catch(e){throw e}}handleAuthFailure(){localStorage.removeItem("auth_token"),window.location.pathname.includes("/auth/login")||(window.location.href="/auth/login")}normalizeError(e){let t=function(e){if(e.response){let{status:t,data:s}=e.response;return new n((null==s?void 0:s.error)||(null==s?void 0:s.message)||"An error occurred",(null==s?void 0:s.code)||"HTTP_".concat(t),t,s)}return e.request?new i("Unable to connect to server"):e instanceof n?e:new n(e.message||"An unexpected error occurred")}(e);return{message:t.message,status:t.status,code:t.code,details:t.details}}createNetworkError(e){return{message:"Network error. Please check your connection and try again.",code:"NETWORK_ERROR"}}showErrorToast(e,t){!["/auth/me","/auth/refresh","/frontend-auth/refresh"].some(e=>{var s;return null==t?void 0:null===(s=t.url)||void 0===s?void 0:s.includes(e)})&&e.status&&e.status>=400&&r.A.error(e.message,{id:"error-".concat(e.status,"-").concat(null==t?void 0:t.url)})}getErrorMessage(e){let t=e.response;if((null==t?void 0:t.data)&&"object"==typeof t.data){let e=t.data;if(e.message)return e.message;if(e.error)return e.error;if(e.detail)return e.detail}switch(null==t?void 0:t.status){case 400:return"Bad request. Please check your input.";case 401:return"Authentication required. Please log in.";case 403:return"Access denied. You don't have permission for this action.";case 404:return"Resource not found.";case 409:return"Conflict. The resource already exists or is in use.";case 422:return"Validation error. Please check your input.";case 429:return"Too many requests. Please try again later.";case 500:return"Server error. Please try again later.";case 502:return"Bad gateway. The server is temporarily unavailable.";case 503:return"Service unavailable. Please try again later.";case 504:return"Gateway timeout. The request took too long to process.";default:return e.message||"An unexpected error occurred."}}async get(e,t){return this.client.get(e,t)}async post(e,t,s){return this.client.post(e,t,s)}async put(e,t,s){return this.client.put(e,t,s)}async patch(e,t,s){return this.client.patch(e,t,s)}async delete(e,t){return this.client.delete(e,t)}async uploadFile(e,t,s){let a=new FormData;return a.append("file",t),this.client.post(e,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{s&&e.total&&s(Math.round(100*e.loaded/e.total))}})}constructor(){this.refreshPromise=null,this.client=a.Z.create({baseURL:"".concat("http://localhost:8080/api","/api"),timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!1}),this.setupInterceptors()}}let l=new o},85315:function(e,t,s){s.d(t,{H:function(){return m},a:function(){return u}});var a=s(57437),r=s(2265),n=s(99376),i=s(73965);class o{async login(e,t){return(await i.x.post("/frontend-auth/login",{email:e,password:t})).data}async logout(){await i.x.post("/frontend-auth/logout")}async getCurrentUser(){return(await i.x.get("/frontend-auth/me")).data.data}async refreshToken(){return(await i.x.post("/frontend-auth/refresh")).data}async requestPasswordReset(e){await i.x.post("/auth/forgot-password",{email:e})}async resetPassword(e,t){await i.x.post("/auth/reset-password",{token:e,password:t})}async changePassword(e,t){await i.x.post("/frontend-auth/change-password",{current_password:e,new_password:t})}async updateProfile(e){return(await i.x.patch("/frontend-auth/profile",e)).data.data}async initiateGoogleAuth(e){return(await i.x.get("/auth/google?agentId=".concat(e))).data}async initiateZoomAuth(e){return(await i.x.get("/auth/zoom?agentId=".concat(e))).data}async getOAuthStatus(e){return(await i.x.get("/auth/oauth-status/".concat(e))).data}}let l=new o;var c=s(14438);let d=(0,r.createContext)(void 0);function u(){let e=(0,r.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function m(e){let{children:t}=e,[s,i]=(0,r.useState)(null),[o,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),p=(0,n.useRouter)();(0,r.useEffect)(()=>{f()},[]),(0,r.useEffect)(()=>()=>{m&&clearTimeout(m)},[m]);let f=async()=>{try{let e=localStorage.getItem("auth_token");if(!e){u(!1);return}if(g(e))try{await v()}catch(e){console.error("Token refresh failed:",e),await w();return}let t=await l.getCurrentUser();i(t),x(e)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("auth_token")}finally{u(!1)}},g=e=>{try{let t=JSON.parse(atob(e.split(".")[1])),s=Date.now()/1e3;return t.exp<s+300}catch(e){return!0}},x=e=>{try{let t=JSON.parse(atob(e.split(".")[1])),s=Date.now()/1e3,a=(t.exp-s-300)*1e3;if(a>0){m&&clearTimeout(m);let e=setTimeout(async()=>{try{await v()}catch(e){console.error("Automatic token refresh failed:",e),await w()}},a);h(e)}}catch(e){console.error("Failed to setup token refresh:",e)}},v=async()=>{try{let e=await l.refreshToken();return localStorage.setItem("auth_token",e.token),i(e.user),x(e.token),e.token}catch(e){throw e}},y=(0,r.useCallback)(async(e,t)=>{try{u(!0);let s=await l.login(e,t);localStorage.setItem("auth_token",s.token),i(s.user),x(s.token),c.A.success("Welcome back!",{description:"Logged in as ".concat(s.user.full_name)}),"admin"===s.user.role?p.push("/admin/dashboard"):p.push("/agent/dashboard")}catch(e){throw c.A.error("Login failed",{description:e.message||"Please check your credentials and try again"}),e}finally{u(!1)}},[p]),w=(0,r.useCallback)(async()=>{try{await l.logout()}catch(e){console.error("Logout error:",e)}finally{m&&(clearTimeout(m),h(null)),localStorage.removeItem("auth_token"),i(null),p.push("/auth/login"),c.A.success("Logged out successfully",{description:"You have been securely logged out"})}},[p,m]),b=(0,r.useCallback)(async()=>{try{let e=await l.getCurrentUser();i(e)}catch(e){console.error("Failed to refresh user:",e),w()}},[w]),N=(0,r.useCallback)(e=>!!s&&(s.permissions.includes(e)||"admin"===s.role),[s]),j=(0,r.useMemo)(()=>({user:s,loading:o,login:y,logout:w,refreshUser:b,isAuthenticated:!!s,hasPermission:N,isAgent:(null==s?void 0:s.role)==="agent",isAdmin:(null==s?void 0:s.role)==="admin"}),[s,o,y,w,b,N]);return(0,a.jsx)(d.Provider,{value:j,children:t})}},6638:function(e,t,s){s.d(t,{k:function(){return o}});var a=s(2265),r=s(83080),n=s(85315),i=s(14438);function o(){let{socket:e,connected:t}=(0,r.s)(),{user:s}=(0,n.a)(),[o,l]=(0,a.useState)([]),[c,d]=(0,a.useState)({activeConversations:0,newLeads:0,pendingAppointments:0,systemAlerts:0,apiUsage:{whatsapp:0,openai:0,total:0}}),u=(0,a.useCallback)(e=>{let t={...e,id:Date.now().toString(),timestamp:new Date,read:!1};switch(l(e=>[t,...e.slice(0,49)]),e.type){case"success":i.A.success(e.title,{description:e.message});break;case"error":i.A.error(e.title,{description:e.message});break;case"warning":i.A.warning(e.title,{description:e.message});break;default:i.A.info(e.title,{description:e.message})}},[]),m=(0,a.useCallback)(e=>{l(t=>t.map(t=>t.id===e?{...t,read:!0}:t))},[]),h=(0,a.useCallback)(()=>{l(e=>e.map(e=>({...e,read:!0})))},[]),p=(0,a.useCallback)(()=>{l([])},[]);(0,a.useEffect)(()=>{if(e&&t&&s)return e.on("new_message",e=>{u({type:"info",title:"New Message",message:"Message from ".concat(e.leadName||e.phoneNumber),actionUrl:"/agent/conversations/".concat(e.conversationId),data:e}),d(e=>({...e,activeConversations:e.activeConversations+1}))}),e.on("new_lead",e=>{u({type:"success",title:"New Lead",message:"New lead: ".concat(e.leadName||e.phoneNumber),actionUrl:"/agent/leads/".concat(e.leadId),data:e}),d(e=>({...e,newLeads:e.newLeads+1}))}),e.on("appointment_booked",e=>{u({type:"success",title:"Appointment Booked",message:"Appointment scheduled with ".concat(e.leadName),actionUrl:"/agent/conversations/".concat(e.conversationId),data:e}),d(e=>({...e,pendingAppointments:e.pendingAppointments+1}))}),e.on("lead_status_changed",e=>{u({type:"info",title:"Lead Status Updated",message:"".concat(e.leadName," status changed to ").concat(e.status),actionUrl:"/agent/leads/".concat(e.leadId),data:e})}),e.on("conversation_ended",e=>{d(e=>({...e,activeConversations:Math.max(0,e.activeConversations-1)}))}),e.on("system_alert",e=>{u({type:e.severity||"warning",title:"System Alert",message:e.message,data:e}),d(e=>({...e,systemAlerts:e.systemAlerts+1}))}),e.on("api_usage_update",e=>{d(t=>({...t,apiUsage:{whatsapp:e.whatsapp||t.apiUsage.whatsapp,openai:e.openai||t.apiUsage.openai,total:e.total||t.apiUsage.total}}))}),"admin"===s.role&&(e.on("agent_status_changed",e=>{u({type:"info",title:"Agent Status Changed",message:"".concat(e.agentName," is now ").concat(e.status),actionUrl:"/admin/agents/".concat(e.agentId),data:e})}),e.on("cost_alert",e=>{u({type:"warning",title:"Cost Alert",message:"".concat(e.service," costs are at ").concat(e.percentage,"% of budget"),actionUrl:"/admin/costs",data:e})}),e.on("waba_status_changed",e=>{u({type:"connected"===e.status?"success":"error",title:"WABA Status Changed",message:"".concat(e.agentName,"'s WhatsApp Business account is ").concat(e.status),actionUrl:"/admin/waba",data:e})})),e.on("metrics_update",e=>{d(t=>({...t,...e}))}),()=>{e.off("new_message"),e.off("new_lead"),e.off("appointment_booked"),e.off("lead_status_changed"),e.off("conversation_ended"),e.off("system_alert"),e.off("api_usage_update"),e.off("agent_status_changed"),e.off("cost_alert"),e.off("waba_status_changed"),e.off("metrics_update")}},[e,t,s,u]),(0,a.useEffect)(()=>{e&&t&&s&&e.emit("request_metrics",{userId:s.id,role:s.role})},[e,t,s]);let f=o.filter(e=>!e.read).length;return{notifications:o,metrics:c,unreadCount:f,addNotification:u,markAsRead:m,markAllAsRead:h,clearNotifications:p,connected:t}}},83080:function(e,t,s){s.d(t,{s:function(){return c},w:function(){return d}});var a=s(57437),r=s(2265),n=s(68680),i=s(85315),o=s(46175);let l=(0,r.createContext)(void 0);function c(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useSocket must be used within a SocketProvider");return e}function d(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),{user:m,isAuthenticated:h}=(0,i.a)();return(0,r.useEffect)(()=>{if(!h||!m){s&&(s.disconnect(),c(null),u(!1));return}let e=localStorage.getItem("auth_token"),t=(0,n.io)("ws://localhost:8080",{auth:{token:e,userId:m.id,role:m.role},transports:["websocket","polling"],timeout:2e4});return t.on("connect",()=>{console.log("Socket connected:",t.id),u(!0),t.emit("join_user_room",m.id),"agent"===m.role?t.emit("join_agent_room",m.id):"admin"===m.role&&t.emit("join_admin_room",m.organization_id)}),t.on("disconnect",e=>{console.log("Socket disconnected:",e),u(!1)}),t.on("connect_error",e=>{console.error("Socket connection error:",e),u(!1)}),t.on("new_message",e=>{(e.agentId===m.id||"admin"===m.role)&&o.ZP.success("New message from ".concat(e.leadName||e.phoneNumber))}),t.on("lead_status_changed",e=>{(e.agentId===m.id||"admin"===m.role)&&o.ZP.success("Lead ".concat(e.leadName," status changed to ").concat(e.status))}),t.on("appointment_booked",e=>{(e.agentId===m.id||"admin"===m.role)&&o.ZP.success("New appointment booked with ".concat(e.leadName))}),t.on("system_notification",e=>{switch(e.type){case"info":o.ZP.success(e.message);break;case"warning":case"error":o.ZP.error(e.message);break;default:(0,o.ZP)(e.message)}}),t.on("agent_status_changed",e=>{"admin"===m.role&&(0,o.ZP)("Agent ".concat(e.agentName," is now ").concat(e.status))}),c(t),()=>{t.disconnect(),c(null),u(!1)}},[h,m]),(0,a.jsx)(l.Provider,{value:{socket:s,connected:d,joinRoom:e=>{s&&d&&s.emit("join_room",e)},leaveRoom:e=>{s&&d&&s.emit("leave_room",e)},emit:(e,t)=>{s&&d&&s.emit(e,t)}},children:t})}},94508:function(e,t,s){s.d(t,{cn:function(){return n}});var a=s(61994),r=s(53335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}}}]);